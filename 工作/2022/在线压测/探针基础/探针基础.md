# 探针安装

## 地址参考

探针安装参考地址：

```
http://10.18.28.181/zh/探针/simulator-agent安装手册
```

测试环境在线压测平台，查看探针是否安装成功。

```
http://10.30.16.102:30080
```

工具平台

```
http://10.30.16.102:30080/console/
```

右上角可以选择各种功能。

![image-20220615153432561](../../../../img/image-20220615153432561.png)

旧版链路调试：

```
http://10.18.20.68:18086
```





## 测试环境探针安装

wget不好用时，使用curl

```
cd /opt/
rm -rf simulator-agent
curl -O 10.18.20.60/artifactory/OPMS-Generic-Release-Local/commoon/simulator-agent-release.tar
tar -xf simulator-agent-release.tar
```



# 压测平台使用

## 新增白名单

在压测平台10.30.16.102:30080/tro/#/appManage下搜索系统名称，进入应用管理页面。

![image-20220616092546057](../../../../img/image-20220616092546057.png)

应用状态下可以查看一些白名单配置

![image-20220616092809321](../../../../img/image-20220616092809321.png)

点击远程调用编辑即可。

![image-20220616094407423](../../../../img/image-20220616094407423.png)



## 通过traceId排查全部接口

通过jmeter请求中，header携带traceid的方式，排查所有的外部调用接口。

traceid在jemeter下的配置方法是

```
ffffffff$(__time(,))0${__Random(100,999,)}d0030
```

![image-20220616094941838](../../../../img/image-20220616094941838.png)

可以先将p-pradar-cluster-test置为非true。之后使用业务流量进行全部接口的查看。和压测平台的白名单做对比。

![image-20220616095459310](../../../../img/image-20220616095459310.png)



## 生产环境

在线压测生产平台的登录地址为：

10.20.46.54/tro/#/login

需要使用admin账号进行登录，具体密码查看腾讯云文档的《机器密码资源》。



## 海东青日志排查

海东青可以根据请求的traceid，在header中进行查找，判断是否是自己测试的这条数据。

![image-20220616130512267](../../../../img/image-20220616130512267.png)



## 查看应用涉及了哪些中间件

以下是查看e门店访问redis。

![image-20220616165815971](../../../../img/image-20220616165815971.png)



## redis内容排查

Redis 的key加入黑名单，使得应用访问正式的redis。

![image-20220616170150754](../../../../img/image-20220616170150754.png)

redis的key值设置黑名单可能不管用，影子redis的原理是在key之前加入ptok_前缀。使用redis desktop manager可以连接eshop的性能redis查看内容。放在了2022新工作的redis管理路径下。

![image-20220617105023994](../../../../img/image-20220617105023994.png)



## mock

mock有两种方式，一种是函数返回的mock。另一种是mock server，需要开墙。



## 旧版链路调试

左侧输入traceid后可以进行链路查看。

![image-20220617141926337](../../../../img/image-20220617141926337.png)